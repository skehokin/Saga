<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://fonts.googleapis.com/css?family=Roboto:100,300" rel="stylesheet">
		<link href="static/sagastyle.css" rel="stylesheet">
		<link href="static/{{user_buttons}}.css" rel="stylesheet">
		<script type="text/javascript" src="static/saga.js"></script>
		<title>{{blog_name}} on saga</title>
		<style>
			.blogHero {
				background-image: url(static/{{image}});
			}

			{% if error == "other" %}
				.edit_delete {
					display: block;
				}
			{% endif %}

			{% if error == "self" %}
				.like_error {
					display: block;
				}
			{% endif %}

			{% if website_type == "single" %}
				.permalink {
					display: none;
				}
			{% endif %}
		</style>
	</head>
	<body class="blogbody">
		<header class="header">
			<a href="/">
				<img src = "/static/sagaLogo.svg" class = "smallLogo">
			</a>
			<span class="toprightlinks">
				<a href="/logout" class="logout">
					log out
				</a>
				<a href="/login" class="login">
					log in
				</a>
			</span>
		</header>
		<main>
			<header class="blogHero">
				<a href="{{username}}">
					<h1 class="blogname">
						{{blog_name}}
					</h1>
				</a>
				<section class="buttonwrap">
					<a href="/newpost">
						<section class="loginSubmit newpost">
							NEW POST
						</section>
					</a>
				</section>
			</header>
			<nav class="blognavwrap">
				<h3 class="blognav">
					about
				</h3>
				<h3 class="blognav">
					archive
				</h3>
			</nav>
			<!-- <div class="clear"></div> -->

			<section class="error_msg like_error hidden" id="like_error">
				dude,
				<br>
				I'm sorry to tell you this,
				<br>
				but you can't like your own post.
				<br>
				<br>
				<button class="loginSubmit" id="like_error_button">
					ok fine
				</button>
			</section>
			<section class="error_msg edit_delete hidden" id="edit_delete">
				you're not {{error_author}}!
				<br>
				you can't do that!
				<br>
				<br>
				<button class="loginSubmit" id="edit_delete_button">
					oops
				</button>
			</section>

			{% for element in blog_posts %}
				<article class="wholepost">
					<article class="blogpost">
						<header class="blogheader">
							<h2 class="blogtitle">
								{{element.subject}}
							</h2>
							<h3>
								by {{element.author}}  -  {{element.created.strftime("%H:%M %A %d %B %Y")}}.
								<br>
								{{element.likes_length}} people like this post.
							</h3>
						</header>
					<section class="postcontent">
						{{element.content |safe}}
					</section>
						{% if element.created.strftime("%H:%M %A %d %B %Y") != element.last_edited.strftime("%H:%M %A %d %B %Y") %}
							<h4 class="posteditnote">
								last edited {{element.last_edited.strftime("%H:%M %A %d %B %Y")}}
							</h4>
						{%endif%}
					</article>
					<footer class="blogpostoptions">
						<div class="optionswrapper">
							<a href="/_like/{{element.identity}}">
								<h3 class="option like">
									<span class="entypo-heart">
									</span>
								</h3>
							</a>
							<a href="/_delete/{{element.identity}}">
								<h3 class="option delete">
									<span class="entypo-cup">
									</span>
								</h3>
							</a>
							<a href="/_edit/{{element.identity}}">
								<h3 class="option edit">
									<span class="entypo-pencil">
									</span>
								</h3>
							</a>
								<h3 class="option commentbutton" id="button{{loop.index}}">
								<span class="entypo-chat">
								</span>
								</h3>
							<a href="/{{element.identity}}">
								<h3 class="option permalink">
									<span class="entypo-infinity">
									</span>
								</h3>
							</a>
						</div>
					</footer>

					<section class="commentwrap" id="comment{{loop.index}}">
						<h3>
						comments on {{element.subject}}
						</h3>

						{% for each in comments if each.post_identity==element.identity%}
							<article class="singlecomment">
								<section class="commentcontent">
									{{each.content}}
								</section>
								<footer>
									<p>
										Posted at
										<time>
											{{each.created.strftime("%H:%M on %A %d %B %Y")}}
										</time>
										by
										<a href="/{{each.author}}">
											{{each.author}}.
										</a>
										{% if each.author == logged_in_user %}
											<form method="get">
												<p class="comment_options">
												<input type="hidden" name="comment_id" value="{{each.comment_id}}">
												<input type="submit" class="entypo-pencil comment_option edit" value="&#x270e;">
											</form>
											<form method="get" action="/_commentdelete/{{each.comment_id}}">
												<p class="comment_options">
												<input type="hidden" name="website_type" value="{{website_type}}">
												<input type="submit" class=" comment_option edit" value="&#x2615;">
											</form>
										{%endif%}
								</footer>
							</article>
						{% else %}
							<article class="singlecomment">
								<section class="commentcontent">
									This post has no comments yet.
								</section>
							</article>
						{%endfor%}

						{% if element.identity==post_id %}
							<form method="post">
								<label>
									<p>
										edit your comment
									</p>
									<p>
										<textarea name="content" class="commentBox">{{comment_content}}</textarea>
									</p>
								</label>
								<input type="hidden" name="comment_id" value="{{edit_comment_id}}">
								<input type="hidden" name="post_id" value="{{element.identity}}">
								<input type="submit" name="commentsubmit" class="loginSubmit newcomment" value="edit comment">
								<a href="/{{username}}">
									<span class="loginSubmit newcomment">
										cancel edit
									</span>
								</a>
							</form>
						{%else%}
							<form method="post">
								<label>
									<p>
										make a comment
									</p>
									<p>
										<textarea name="content" class="commentBox">
										</textarea>
									</p>
								</label>
								<input type="hidden" name="post_id" value="{{element.identity}}">
								<input type="submit" name="commentsubmit" class="loginSubmit newcomment" value="add comment">
							</form>
						{%endif%}
					</section>
				</article>
			{%else%}
				<article class="wholepost">
					<article class="blogpost">
						<header class="blogheader">
							<h2 class="blogtitle">
								No Posts Yet!
							</h2>
							<h3>
								by saga
							</h3>
						</header>
							<section class="postcontent">
								It looks like {{username}} hasn't made any posts yet.
							</section>
					</article>
				</article>
			{%endfor%}
		</main>
		<script>
			{% for element in blog_posts%}
				document.getElementById('button{{loop.index}}').onclick = function() {
					var thecomment = document.getElementById('comment{{loop.index}}')
					if (thecomment.style.display==="block") {
						thecomment.style.display="none";
					}
					else {
						thecomment.style.display="block";
					}
				}

			{%endfor%}

			document.getElementById('like_error_button').onclick = function() {
				document.getElementById('like_error').style.display="none";
			}
			document.getElementById('edit_delete_button').onclick = function() {
				document.getElementById('edit_delete').style.display="none";
			}
		</script>
	</body>
</html>
